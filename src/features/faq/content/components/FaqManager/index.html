<template id="yi-pet-faq-manager-template">
    <div
        id="pet-faq-manager"
        class="pet-faq-manager"
        :class="{ 'pet-is-visible': store.visible }"
        ref="rootEl"
        role="dialog"
        aria-modal="true"
        aria-label="Â∏∏ËßÅÈóÆÈ¢ò"
        tabindex="0"
        @click.self="close"
        @keydown.esc.prevent.stop="close"
    >
        <div class="pet-faq-manager-modal" role="document">
            <div class="pet-faq-manager-header">
                <div class="pet-faq-manager-title">
                    üí° Â∏∏ËßÅÈóÆÈ¢ò <span class="pet-faq-manager-title-sub">Ôºà‰∏ÄÈîÆÊèíÂÖ•/ÂèëÈÄÅÔºâ</span>
                </div>
                <button type="button" class="pet-faq-modal-close" aria-label="ÂÖ≥Èó≠" @click="close">‚úï</button>
            </div>

            <div class="pet-faq-modal-content">
                <div class="pet-faq-layout">
                    <div class="pet-faq-sidebar" aria-label="Á≠õÈÄâ‰∏éÊ†áÁ≠æ">
                        <div class="pet-faq-search-row">
                            <input
                                ref="searchInputEl"
                                type="text"
                                class="pet-faq-search-input"
                                placeholder="ÊêúÁ¥¢Â∏∏ËßÅÈóÆÈ¢ò..."
                                aria-label="ÊêúÁ¥¢Â∏∏ËßÅÈóÆÈ¢ò"
                                v-model="store.searchFilter"
                            />
                            <button
                                type="button"
                                class="pet-faq-search-clear"
                                aria-label="Ê∏ÖÈô§ÊêúÁ¥¢"
                                title="Ê∏ÖÈô§ÊêúÁ¥¢"
                                :disabled="!store.searchFilter"
                                @click="clearSearch"
                            >
                                Ê∏ÖÈô§
                            </button>
                        </div>

                    <div class="pet-faq-filter-row" aria-label="Â∏∏ËßÅÈóÆÈ¢òÊ†áÁ≠æÁ≠õÈÄâ">
                        <div class="pet-faq-filter-actions">
                            <button
                                type="button"
                                class="pet-faq-filter-btn"
                                aria-label="ÂèçÈÄâ"
                                title="‰∏çÂåÖÂê´ÈÄâ‰∏≠Ê†áÁ≠æ"
                                :class="{ active: store.tagFilterReverse }"
                                @click="toggleReverse"
                            >
                                ÂèçÈÄâ
                            </button>
                            <button
                                type="button"
                                class="pet-faq-filter-btn"
                                aria-label="Êó†Ê†áÁ≠æ"
                                title="Âè™ÊòæÁ§∫Êó†Ê†áÁ≠æÈóÆÈ¢ò"
                                :class="{ active: store.tagFilterNoTags }"
                                @click="toggleNoTags"
                            >
                                Êó†Ê†áÁ≠æ
                            </button>
                            <button
                                type="button"
                                class="pet-faq-filter-btn"
                                aria-label="Ê∏ÖÈô§Ê†áÁ≠æÁ≠õÈÄâ"
                                title="Ê∏ÖÈô§Ê†áÁ≠æÁ≠õÈÄâ"
                                :disabled="store.selectedTags.length === 0 && !store.tagFilterReverse && !store.tagFilterNoTags"
                                @click="clearTagFilters"
                            >
                                Ê∏ÖÈô§Ê†áÁ≠æ
                            </button>
                            <button
                                type="button"
                                class="pet-faq-filter-btn"
                                aria-label="Ê†áÁ≠æÁÆ°ÁêÜ"
                                title="Ê†áÁ≠æÁÆ°ÁêÜ"
                                :class="{ active: store.tagManagerVisible }"
                                @click="toggleTagManager"
                            >
                                Ê†áÁ≠æÁÆ°ÁêÜ
                            </button>
                            <button
                                type="button"
                                class="pet-faq-filter-btn"
                                aria-label="Âà∑Êñ∞"
                                title="‰ªéÊé•Âè£Âà∑Êñ∞"
                                :disabled="store.isLoading"
                                @click="refresh"
                            >
                                Âà∑Êñ∞
                            </button>
                        </div>

                        <div class="pet-faq-tag-search">
                            <input
                                type="text"
                                class="pet-faq-tag-search-input"
                                placeholder="ÊêúÁ¥¢Ê†áÁ≠æ..."
                                aria-label="ÊêúÁ¥¢Ê†áÁ≠æ"
                                v-model="store.tagFilterSearchKeyword"
                            />
                            <button
                                type="button"
                                class="pet-faq-filter-btn"
                                aria-label="Ê∏ÖÈô§Ê†áÁ≠æÊêúÁ¥¢"
                                title="Ê∏ÖÈô§Ê†áÁ≠æÊêúÁ¥¢"
                                :disabled="!store.tagFilterSearchKeyword"
                                @click="clearTagSearch"
                            >
                                Ê∏ÖÈô§
                            </button>
                        </div>

                        <div class="pet-faq-tag-list" role="list" aria-label="Ê†áÁ≠æÂàóË°®">
                            <button
                                v-for="tag in visibleTags"
                                :key="tag"
                                type="button"
                                class="pet-faq-tag"
                                role="listitem"
                                :class="{ active: store.selectedTags.includes(tag) }"
                                :aria-label="'Á≠õÈÄâÊ†áÁ≠æÔºö' + tag"
                                @click="toggleTag(tag)"
                            >
                                {{ tag }}
                            </button>

                            <button
                                v-if="moreToggleVisible"
                                type="button"
                                class="pet-faq-tag more"
                                role="listitem"
                                aria-label="Â±ïÂºÄÊàñÊî∂Ëµ∑Ê†áÁ≠æ"
                                @click="toggleMoreTags"
                            >
                                {{ store.tagFilterExpanded ? 'Êî∂Ëµ∑' : 'Êõ¥Â§ö' }}
                            </button>
                        </div>

                        <div v-if="store.tagManagerVisible" class="pet-faq-tag-manager" aria-label="Ê†áÁ≠æÁÆ°ÁêÜÈù¢Êùø">
                            <div class="pet-faq-tag-manager-header">
                                <div class="pet-faq-tag-manager-title">Ê†áÁ≠æÁÆ°ÁêÜ</div>
                                <button
                                    type="button"
                                    class="pet-faq-filter-btn"
                                    aria-label="ÂÖ≥Èó≠Ê†áÁ≠æÁÆ°ÁêÜ"
                                    @click="toggleTagManager"
                                >
                                    ÂÖ≥Èó≠
                                </button>
                            </div>

                            <div class="pet-faq-tag-manager-list" role="list" aria-label="ÂèØÁÆ°ÁêÜÊ†áÁ≠æÂàóË°®">
                                <div v-for="tag in allTags" :key="tag" class="pet-faq-tag-manager-item" role="listitem">
                                    <div class="pet-faq-tag-manager-item-tag">{{ tag }}</div>
                                    <div class="pet-faq-tag-manager-item-actions">
                                        <button
                                            type="button"
                                            class="pet-faq-tag-manager-btn"
                                            aria-label="ÈáçÂëΩÂêçÊ†áÁ≠æ"
                                            @click="renameTag(tag)"
                                        >
                                            ÈáçÂëΩÂêç
                                        </button>
                                        <button
                                            type="button"
                                            class="pet-faq-tag-manager-btn danger"
                                            aria-label="Âà†Èô§Ê†áÁ≠æ"
                                            @click="deleteTag(tag)"
                                        >
                                            Âà†Èô§
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="pet-faq-main" aria-label="Â∏∏ËßÅÈóÆÈ¢òÂàóË°®">
                    <div class="pet-faq-summary" role="status" aria-label="Á≠õÈÄâÁªìÊûú">
                        {{ summaryText }}
                    </div>

                    <div class="pet-faq-input-row" aria-label="Ê∑ªÂä†Â∏∏ËßÅÈóÆÈ¢ò">
                        <textarea
                            class="pet-faq-input"
                            placeholder="ËæìÂÖ•ÈóÆÈ¢òÂÜÖÂÆπÔºåÊåâ Ctrl+Enter Êàñ Shift+Enter Ê∑ªÂä†"
                            aria-label="Êñ∞Â¢ûÂ∏∏ËßÅÈóÆÈ¢ò"
                            v-model="store.newFaqText"
                            @keydown="onNewFaqKeydown"
                        ></textarea>
                        <div class="pet-faq-input-hint">ÊîØÊåÅÂ§öË°åÂÜÖÂÆπÔºåÈ¶ñË°å‰Ωú‰∏∫Ê†áÈ¢òÔºå‰Ωô‰∏ã‰Ωú‰∏∫Ê≠£Êñá„ÄÇ</div>
                    </div>

                    <div v-if="store.isLoading" class="pet-faq-status" role="status">Ê≠£Âú®Âä†ËΩΩÂ∏∏ËßÅÈóÆÈ¢ò...</div>
                    <div v-if="store.error" class="pet-faq-error" role="status">{{ store.error }}</div>

                    <div class="pet-faq-list" role="list" aria-label="Â∏∏ËßÅÈóÆÈ¢òÂàóË°®">
                        <div v-if="filteredFaqs.length === 0" class="pet-faq-empty" role="listitem">Êú™ÊâæÂà∞ÂåπÈÖçÁöÑÂ∏∏ËßÅÈóÆÈ¢ò</div>

                        <div
                            v-for="(faq, index) in filteredFaqs"
                            :key="faq.key"
                            class="pet-faq-item"
                            role="listitem"
                            tabindex="0"
                            @click="onFaqInsert(faq)"
                            @keydown="onFaqKeydown($event, faq)"
                        >
                            <div class="pet-faq-item-title-row">
                                <div class="pet-faq-item-title">{{ faq.title || faq.text || 'Â∏∏ËßÅÈóÆÈ¢ò' }}</div>
                            </div>

                            <div class="pet-faq-item-meta-row">
                                <div
                                    v-if="Array.isArray(faq.tags) && faq.tags.length > 0"
                                    class="pet-faq-item-tags"
                                    aria-label="ÈóÆÈ¢òÊ†áÁ≠æ"
                                >
                                    <button
                                        v-for="tag in faq.tags"
                                        :key="tag"
                                        type="button"
                                        class="pet-faq-item-tag"
                                        :aria-label="'Á≠õÈÄâÊ†áÁ≠æÔºö' + tag"
                                        @click.stop="toggleTag(tag)"
                                    >
                                        {{ tag }}
                                    </button>
                                </div>

                                <div class="pet-faq-item-actions">
                                    <button
                                        type="button"
                                        class="pet-faq-item-btn"
                                        aria-label="Ê†áÁ≠æ"
                                        @click.stop="editTags(index)"
                                    >
                                        Ê†áÁ≠æ
                                    </button>
                                    <button
                                        type="button"
                                        class="pet-faq-item-btn"
                                        aria-label="ÊèíÂÖ•"
                                        @click.stop="onFaqInsert(faq)"
                                    >
                                        ÊèíÂÖ•
                                    </button>
                                    <button
                                        type="button"
                                        class="pet-faq-item-btn"
                                        aria-label="Â§çÂà∂"
                                        title="Â§çÂà∂"
                                        @click.stop="onFaqCopy(faq)"
                                    >
                                        Â§çÂà∂
                                    </button>
                                    <button
                                        type="button"
                                        class="pet-faq-item-btn primary"
                                        aria-label="ÂèëÈÄÅ"
                                        @click.stop="onFaqSend(faq)"
                                    >
                                        ÂèëÈÄÅ
                                    </button>
                                    <button
                                        type="button"
                                        class="pet-faq-item-btn danger"
                                        aria-label="Âà†Èô§"
                                        :disabled="!!store.deletingFaqKeys[faq.key]"
                                        @click.stop="deleteFaq(faq)"
                                    >
                                        {{ store.deletingFaqKeys[faq.key] ? 'Âà†Èô§‰∏≠...' : 'Âà†Èô§' }}
                                    </button>
                                </div>
                            </div>

                            <div class="pet-faq-item-prompt">{{ faq.prompt || '' }}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>
